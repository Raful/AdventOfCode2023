using System;
using System.Collections;
using System.Collections.Generic;
using System.Threading.Tasks;
using UnityEngine;
using static Day10;
using UnityEngine.Windows;
using System.Linq;
using System.Text;

public class Day11 : MonoBehaviour
{
    string _input = "..............................#.............#.....#.............#...........#......................................#...............#........\r\n....................#.........................................................................#.........#...................................\r\n...........#............................#...............................................#...................................................\r\n......................................................................#...........................#.........................................\r\n.#.......................................................#.....................................................#.............#..............\r\n......................#.............#..............................................#.......#..........#.....................................\r\n............................................................................................................................................\r\n................#..........#................#................#................#........#..................................#.................\r\n...................................................#........................................................#......................#........\r\n............................................................................................................................................\r\n.....#............................................................#.........................................................................\r\n................................#.......................................#........#.............#........#.....................#.............\r\n...........................................#.......................................................................#........................\r\n..........#...........................................................................................................................#.....\r\n.#.................................................#.....................................................................#..................\r\n............................#......#.........................................#..............#................#..............................\r\n..............#..........................................#........#...............................#.........................................\r\n...................#.......................................................................................................................#\r\n.........#..................................................................................................................................\r\n..........................................................................................................#................#................\r\n..#..........................................#.................................#.......#......#.......................#.....................\r\n..................................................#.........................................................................................\r\n.......#................#................................................#..................................................................\r\n.............................#...........#...................#......................#............#...............................#.........#\r\n.............#......................................................................................................#.......................\r\n..............................................#................................................................#............................\r\n.....................................#............................#..........#...........................#.................#................\r\n.....................#......................................................................................................................\r\n#.........................................#.......................................................#...............................#.........\r\n......................................................................#.....................................................................\r\n...................................#..................#........#....................#............................#..........................\r\n...................#............................#...........................................................................................\r\n...................................................................#....................#.....................................#........#....\r\n.........#...............................#.....................................#.......................................#....................\r\n.#..........................................................................................................................................\r\n............................................................................................#......................#.......................#\r\n................#..............#.............................#.......................#............#................................#........\r\n.....................#............................#...............#.........................................................................\r\n........................................................#.......................#.........................................#.................\r\n...........................#..........................................#...............................#.....................................\r\n.....................................#.....................................................................#................................\r\n...........#.......#.............................................................................................................#.......#..\r\n.....#........................#..................#..................................................................#.......................\r\n...........................................#................................#...............................................................\r\n..............................................................#.............................................................................\r\n........................................................#............#...............#......................#...............................\r\n.#..........................................................................................................................................\r\n....................#...........#.......................................................................................#...................\r\n......................................#..............#...........#.................................................#...................#....\r\n.......#.....#..........#....................................................................#.................................#............\r\n.............................#..............#...............................................................................................\r\n............................................................................................................................................\r\n#............................................................#.....................................#.....................................#..\r\n....................#..................................#...........................#.....................#..................................\r\n............................................................................................................................................\r\n............#..........................................................#.............................................................#......\r\n............................#...................................#.............#.................#.............#......#......#...............\r\n..................#...........................#.............................................................................................\r\n.......................#...........#.................................................#............................................#.........\r\n............................................................................................................................................\r\n..............................#.........#.................................#............................................................#....\r\n............................................................................................................................................\r\n....#.................................................................#...................................#..............#..................\r\n...........#..................................................#...................................#.............#...........................\r\n................#...........................#...............................................................................................\r\n.#.....................#...............................#...........#...........#.....#.............................................#........\r\n............................................................................................................................................\r\n........#........................#.....................................#...............................................#....................\r\n............................................................................................................................................\r\n................................................................................................................#...........................\r\n............................................................................................................................................\r\n......................................#..............#.........#...........#...........#...............#....................................\r\n...........#.......................................................................................................#.................#......\r\n......#.....................................#.......................#......................#..............................................#.\r\n..............................................................................#..............................................#..............\r\n...............................#...........................#................................................#...............................\r\n................................................#...................................................#............#...............#..........\r\n............#............................#................................#.............#................................#..................\r\n.................#.......#..................................................................................................................\r\n....................................#.................................#..............................................#...............#......\r\n.........#..................................................................................................................................\r\n.............................#.................................................................................#............................\r\n......................#...................#..................................................#.........#....................................\r\n............................................................................................................................................\r\n#..................................................#........................................................................................\r\n........#.......................................................................#.................................#.......#.................\r\n.............#.........................................#............#..............................................................#........\r\n.....................................#........................#......................#............#.........................................\r\n.........................#.......................#..........................#...........................#......................#............\r\n.................................#.........#................................................................................................\r\n...................#.........................................................................#..........................#...................\r\n............................................................................................................................................\r\n..............................#....................#............#.........................................................................#.\r\n.........................................................................................................#.......#.........#................\r\n..........#.......................................................................................................................#.........\r\n....#.............#.......#.........................................#............#..........................................................\r\n...................................#........................................................................................................\r\n...........................................................#............................................................#...................\r\n#..............................#.............#.....#.........................#.......#...............#........................#.....#.......\r\n................................................................................................#........................................#..\r\n........#...............#................................................................#...........................#......................\r\n...................#.....................................#.......................#.........................................#................\r\n............................................................................................................................................\r\n..............#..................................................#...........................#...................#..........................\r\n...............................#..............#...........................#.................................................................\r\n#..........................................................#........................#..........................................#.......#....\r\n.....................................................#....................................................#.........#.......................\r\n..........................#................................................................#......#.......................#.................\r\n....#.....#.....................................................................................................#...........................\r\n.....................#.....................#..........................................#.....................................................\r\n.........................................................................#..............................................................#...\r\n..............#......................................................................................#........................#.............\r\n...........................#..........#............#...............................................................#........................\r\n........#....................................#..............................................................................................\r\n.................................................................#..........................#....................................#..........\r\n.................................................................................#.....................#.....#...........................#..\r\n............................................................................................................................................\r\n..........................#.................................................................................................................\r\n..............................................................................#.............................................................\r\n.........................................................................#...................#......................................#.......\r\n...#.........#......#................................#..................................................................#...................\r\n...............................#.............#...............#.......................#...........................#..........................\r\n.......................................................................................................#.........................#..........\r\n............................................................................#...............................................................\r\n.#....................#.............................................#....................................................................#..\r\n....................................#..................#....................................................................................\r\n.....#........................#...............#..........................#...................................#..............................\r\n...........#........................................................................................#.......................................\r\n................#.........#................................#.....#..............................................................#...........\r\n......................................#..............................................#.................................................#....\r\n.................................................................................................#......#........#.....#....................\r\n#......................#.............................................#......................................................................\r\n..............#..........................#..............#...................................................................................\r\n...........................................................................#................................................................\r\n..................#..............#.................#..............#...........................................#.....................#.......\r\n............................................................................................#...............................................\r\n..........................#.............................................#........#........................#.................................\r\n..........#...........................................#.....................................................................................\r\n......................................#........................#...............................#...........................................#\r\n.....#........#..............#.......................................#.............................................#..........#.............";

    const char GALAXY_SYMBOL = '#';
    const char EMPTY_SYMBOL = '.';

    private void Awake()
    {
        Debug.Log("Day 11 part 1: " + ExecutePart1(_input));
        Debug.Log("Day 11 part 2: " + ExecutePart2(_input));
    }

    class Galaxy
    {
        public int xRaw;
        public int yRaw;

        public int xAdded;
        public int yAdded;

        public int x => xRaw + xAdded;
        public int y => yRaw + yAdded;
        public int x2 => xRaw + xAdded * 1_000_000 - xAdded;
        public int y2 => yRaw + yAdded * 1_000_000 - yAdded;

        public Galaxy(int x, int y)
        {
            this.xRaw = x;
            this.yRaw = y;
        }
    }

    long ExecutePart1(string input)
    {
        string[] inputLines = Common.SplitLines(input);
        //string[] expandedInputLine = AddEmptyLines(inputLines);

        List<Galaxy> galaxies = ParseGalaxies(inputLines);


        long distanceSum = 0;

        for (int i = 0; i < galaxies.Count; i++)
        {
            for (int j = i + 1; j < galaxies.Count; j++)
            {
                distanceSum += Mathf.Abs(galaxies[j].x - galaxies[i].x) + Mathf.Abs(galaxies[j].y - galaxies[i].y);
            }
        }

        return distanceSum;
    }

    long ExecutePart2(string input)
    {
        string[] inputLines = Common.SplitLines(input);
        //string[] expandedInputLine = AddEmptyLines(inputLines);

        List<Galaxy> galaxies = ParseGalaxies(inputLines);


        long distanceSum = 0;

        for (int i = 0; i < galaxies.Count; i++)
        {
            for (int j = i + 1; j < galaxies.Count; j++)
            {
                distanceSum += Mathf.Abs(galaxies[j].x2 - galaxies[i].x2) + Mathf.Abs(galaxies[j].y2 - galaxies[i].y2);
            }
        }

        return distanceSum;
    }

    List<Galaxy> ParseGalaxies(string[] inputLines)
    {
        List<Galaxy> galaxies = new List<Galaxy>();

        for (int y = 0; y < inputLines.Length; y++)
        {
            for (int x = 0; x < inputLines[y].Length; x++)
            {
                if (inputLines[y][x] == GALAXY_SYMBOL)
                {
                    galaxies.Add(new Galaxy(x, y));
                }
            }
        }


        int linesAdded = 0;
        for (int y = 0; y < inputLines.Length; y++)
        {
            List<Galaxy> galaxiesInLine = galaxies.FindAll(g => g.yRaw == y);
            if (galaxiesInLine.Count > 0)
            {
                for (int i = 0; i < galaxiesInLine.Count; i++)
                {
                    galaxiesInLine[i].yAdded = linesAdded;
                }
            }
            else
            {
                linesAdded++;
            }
        }

        int columnsAdded = 0;
        for (int x = 0; x < inputLines[0].Length; x++)
        {
            List<Galaxy> galaxiesInLine = galaxies.FindAll(g => g.xRaw == x);
            if (galaxiesInLine.Count > 0)
            {
                for (int i = 0; i < galaxiesInLine.Count; i++)
                {
                    galaxiesInLine[i].xAdded = columnsAdded;
                }
            }
            else
            {
                columnsAdded++;
            }
        }

        return galaxies;
    }
}
